# NIP 4 - URI Schema
```
    NIP: 4
    Title: URI Schema
    Author: David Garcia <david@nemeurope.eu>
    Comments-Summary: No comments yet.
    Status: Draft
    Type: Standards Track
    Layer: Application
    Created: 2018-12-18
    License: BSD-2-Clause
```

## Introduction

This NIP defines a URI schema to serve transactions ready to be signed.

## Specification

**URI schema**

``nem://transaction?type=<type>?format=<format>?data=<data>``

|**Parameter**      | **Description** |
| ----------------- | ------------- |
| type   | The [transaction type id](https://nemtech.github.io/concepts/transaction.html) in hexadecimal. |
| format | "json", "binary" |
| data   | The transaction [formatted as JSON](https://github.com/nemtech/nem2-sdk-java/blob/450676210c5a75f4624fc3bee7bbde96740109d1/src/main/java/io/nem/sdk/infrastructure/TransactionMapping.java) or [serialized hexadecimal form](https://nemtech.github.io/api/serialization.html).|
| chainId | The chain [identifier](https://github.com/nemtech/catapult-server/blob/master/resources/config-network.properties#L3). |


## Motivation

An application built-on NEM may request an account to sign a prepared transaction. Taking as an example the following user story:

``` 
As a customer,
I want to pay for a ticket using my wallet,
so that there is no need to trust the ticket vendor website.
```

The customer has selected a ticket on the ticket vendor website and it is ready to pay. 
The experience suggests that apps built on NIS1 would use one of the following solutions:

**A) The ticket vendor offers a client-side app**

A user downloads the ticket vendor open-source app in local to sign a transaction.
Then, the user can inspect the code, checking the transaction defined does what is expected.

From the UX point of view, having to inspect the code to see what the app is not ideal.

**B) The customer sends a transaction to a determined address**

The user has to define the transaction manually in the NEMWallet. The address or the message set could be wrong, and the user spends an unnecessary time.

**C) The customer scans a QR code**
 
A mobile phone scans a QR code served by an application.
QR codes are useful when a person uses mobile as a secure device, but it is operating with a computer. 
This approach is not complete, since:

* It only works when using two devices, and one of them is a mobile phone.
* NEM has different types of transactions, and the [current QR standard](https://github.com/NemProject/nem-library-ts/blob/master/src/services/QRService.ts#L56) only handled one of them.

The aforementioned downsides encourage looking forward to other alternatives. [This article](https://logbooksocial.github.io/blog/development/2018/11/16/ux-i.html) discusses how the interaction between NEM apps and users should be when signing transactions. One of the proposed approaches is to define a standard URI schema.

## Design Decisions

Applications using NEM must be able to prepare transactions, so that final users can decide to sign them from a secure application.

A URI schema enables the communication between applications and NEM wallet. It can be recognized by desktop and [mobile wallets](https://developer.apple.com/documentation/uikit/core_app/allowing_apps_and_websites_to_link_to_your_content/defining_a_custom_url_scheme_for_your_app), opening the app with the transaction ready to be signed. 

Creating a new URI schema library to extend the SDK is expensive, because of all the possible permutations coming from:

* Each programming language requires the development of a library.
* Each implementation of the library needs to be updated when adding new transaction types.

A convenient solution partially exists, by using SDK classes already implemented in the SDK that serialize and deserialize transactions from JSON and binary (see implementation). The functions from the classes can't be imported, as are used internally. The suggested solution is to make these functions available through the SDK models.

The proposed solution consists in attaching transactions as binary data or JSON, achieving the following properties:

* The schema definition will not change if there is the need to add new types of transactions. 
* The developer can choose the format, deciding if it's more important that the URL is human readable or compact. 

Adding transaction type parameter to the URI schema help the SDK to determine which model should map. 
Inspired in Ethereumâ€™s [Metamask](https://metamask.io/), the next NEM wallet could be served online, but signing and announcing transactions is done from the client side.

## Implementation

This section gathers the required changes in the SDK to support the URI schema.
 
The SDK needs to integrate the new [generated buffers](https://github.com/nemtech/catbuffer) to work with transactions in binary form and include in the transaction models methods to serialize and deserialize the transactions in binary data.

Currently, the NEM-SDK has a class [TransactionMapping](https://github.com/nemtech/nem2-sdk-java/blob/450676210c5a75f4624fc3bee7bbde96740109d1/src/main/java/io/nem/sdk/infrastructure/TransactionMapping.java) to map JSON transactions into models. 

This table gathers the functions that each transaction model should implement, taking advantage of the above-mentioned developed classes.

| **Function**      | **Description**   |
| ----------------- | ------------- |
| serialize():string | Serializes a transaction model into binary |
| serializeJson():json | Serializes a transaction model into JSON |
| createFromBinary(data:string):Transaction | Reads from serialized binary data in hexadecimal |
| createFromJson(data:json):Transaction | Reads from JSON data |

## Backwards compatibility

NIS1 does not have a known standard URI schema.

## Contributors

Special thanks to [@aleixmorgadas](https://github.com/aleixmorgadas), [@dexterslabor](https://github.com/dexterslabor) and [@9zero](https://github.com/9zero) for contributing actively to improve this NIP.

## History

| **Date**          | **Version**   |
| ----------------- | ------------- |
| December 18 2018  | Initial Draft |
| January 15 2019  | Second Draft   |
